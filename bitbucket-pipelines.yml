image: atlassian/default-image:2

pipelines:
    branches:
      main:
        - step:
           script:
             - python --version
             - add-apt-repository universe && apt-get update -y
             - curl https://bootstrap.pypa.io/pip/2.7/get-pip.py  --output get-pip.py
             - python2 get-pip.py
             - apt-get install -y ipython ipython-notebook 
             - apt-get remove -y python-zmq ipython
             - pip install jupyter
             - jupyter nbconvert --to script ipynb/*.ipynb
             - ls ipynb
             - mkdir py && mv ipynb/*.py py
             - git add py
             - git commit -m 'ipynb to py'
             - git remote add sync git@github.com:miyabilink/sukkiri-spython-codes.git
             - git checkout main
             - git pull
             - git merge origin/main
             - git filter-branch -f --env-filter "GIT_AUTHOR_NAME='Shinpei KUDO'; GIT_AUTHOR_EMAIL='kudo@miyabilink.jp'; GIT_COMMITTER_NAME='Shinpei KUDO'; GIT_COMMITTER_EMAIL='kudo@miyabilink.jp';" --tag-name-filter cat -- --all
             - git push sync --tags
             - git push -f sync main
